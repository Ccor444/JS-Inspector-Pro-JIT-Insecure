// cve-checker.js - CVE Database and Vulnerability Checker
// Google Security Research Division - Elite Security Edition

export const CVE_DATABASE = {
    // CVEs espec√≠ficos para JavaScript/Node.js
    javascriptCVEs: [
        {
            cve: 'CVE-2024-27980',
            name: 'Node.js HTTP/2 Rapid Reset Attack',
            severity: 'CRITICAL',
            affectedVersions: 'Node.js < 20.11.0, < 18.19.0',
            description: 'HTTP/2 Rapid Reset Attack pode causar DoS',
            cvssScore: '7.5',
            cwe: 'CWE-400',
            references: [
                'https://nvd.nist.gov/vuln/detail/CVE-2024-27980',
                'https://nodejs.org/en/blog/vulnerability/april-2024-security-releases'
            ],
            mitigation: 'Atualizar Node.js para vers√£o 20.11.0 ou superior, 18.19.0 ou superior'
        },
        {
            cve: 'CVE-2024-27919',
            name: 'Node.js HTTP/2 Flood Attack',
            severity: 'HIGH',
            affectedVersions: 'Node.js < 20.11.0, < 18.19.0',
            description: 'HTTP/2 Flood Attack pode causar consumo excessivo de recursos',
            cvssScore: '7.5',
            cwe: 'CWE-400',
            references: [
                'https://nvd.nist.gov/vuln/detail/CVE-2024-27919'
            ],
            mitigation: 'Atualizar Node.js para vers√µes patchadas'
        },
        {
            cve: 'CVE-2023-46809',
            name: 'Node.js Permission Model Bypass',
            severity: 'HIGH',
            affectedVersions: 'Node.js 20.x < 20.11.0',
            description: 'Modelo de permiss√µes pode ser contornado em condi√ß√µes espec√≠ficas',
            cvssScore: '7.1',
            cwe: 'CWE-863',
            references: [
                'https://nvd.nist.gov/vuln/detail/CVE-2023-46809'
            ],
            mitigation: 'Atualizar para Node.js 20.11.0 ou superior'
        },
        {
            cve: 'CVE-2022-24999',
            name: 'QPSQL Driver SQL Injection',
            severity: 'CRITICAL',
            affectedVersions: 'Qt < 5.15.5, < 6.2.2',
            description: 'SQL Injection no driver QPSQL do Qt',
            cvssScore: '9.8',
            cwe: 'CWE-89',
            references: [
                'https://nvd.nist.gov/vuln/detail/CVE-2022-24999'
            ],
            mitigation: 'Atualizar Qt para vers√£o 5.15.5 ou 6.2.2'
        },
        {
            cve: 'CVE-2021-22931',
            name: 'Node.js ICU Vulnerability',
            severity: 'HIGH',
            affectedVersions: 'Node.js < 14.17.0',
            description: 'Vulnerabilidade no m√≥dulo ICU do Node.js',
            cvssScore: '7.5',
            cwe: 'CWE-400',
            references: [
                'https://nvd.nist.gov/vuln/detail/CVE-2021-22931'
            ],
            mitigation: 'Atualizar Node.js para 14.17.0 ou superior'
        },
        {
            cve: 'CVE-2020-11023',
            name: 'jQuery XSS Vulnerability',
            severity: 'HIGH',
            affectedVersions: 'jQuery < 3.5.0',
            description: 'Cross-site Scripting (XSS) em jQuery',
            cvssScore: '6.1',
            cwe: 'CWE-79',
            references: [
                'https://nvd.nist.gov/vuln/detail/CVE-2020-11023'
            ],
            mitigation: 'Atualizar jQuery para 3.5.0 ou superior'
        },
        {
            cve: 'CVE-2019-10744',
            name: 'Lodash Prototype Pollution',
            severity: 'HIGH',
            affectedVersions: 'lodash < 4.17.12',
            description: 'Prototype pollution em lodash.merge, lodash.mergeWith',
            cvssScore: '7.4',
            cwe: 'CWE-1321',
            references: [
                'https://nvd.nist.gov/vuln/detail/CVE-2019-10744'
            ],
            mitigation: 'Atualizar lodash para 4.17.12 ou superior'
        },
        {
            cve: 'CVE-2018-3721',
            name: 'hoek Prototype Pollution',
            severity: 'HIGH',
            affectedVersions: 'hoek < 4.2.1, < 5.0.3',
            description: 'Prototype pollution na biblioteca hoek',
            cvssScore: '7.5',
            cwe: 'CWE-1321',
            references: [
                'https://nvd.nist.gov/vuln/detail/CVE-2018-3721'
            ],
            mitigation: 'Atualizar hoek para 4.2.1, 5.0.3 ou superior'
        },
        {
            cve: 'CVE-2018-16487',
            name: 'lodash.defaultsDeep Prototype Pollution',
            severity: 'HIGH',
            affectedVersions: 'lodash < 4.17.11',
            description: 'Prototype pollution em lodash.defaultsDeep',
            cvssScore: '7.4',
            cwe: 'CWE-1321',
            references: [
                'https://nvd.nist.gov/vuln/detail/CVE-2018-16487'
            ],
            mitigation: 'Atualizar lodash para 4.17.11 ou superior'
        }
    ],

    // Depend√™ncias comuns e suas vulnerabilidades
    libraryVulnerabilities: {
        'react': [
            {
                cve: 'CVE-2022-0286',
                severity: 'MEDIUM',
                description: 'Cross-site Scripting em React',
                affectedVersions: 'React < 17.0.2',
                mitigation: 'Atualizar React para 17.0.2 ou superior'
            }
        ],
        'vue': [
            {
                cve: 'CVE-2022-25845',
                severity: 'HIGH',
                description: 'Remote Code Execution em vue-loader',
                affectedVersions: 'vue-loader < 15.10.0',
                mitigation: 'Atualizar vue-loader para 15.10.0 ou superior'
            }
        ],
        'angular': [
            {
                cve: 'CVE-2021-37710',
                severity: 'HIGH',
                description: 'Regular Expression Denial of Service (ReDoS)',
                affectedVersions: 'Angular < 11.2.14, < 12.2.5',
                mitigation: 'Atualizar Angular para vers√µes patchadas'
            }
        ],
        'express': [
            {
                cve: 'CVE-2022-24999',
                severity: 'CRITICAL',
                description: 'Query parameter pollution que pode levar a DoS',
                affectedVersions: 'Express < 4.18.0',
                mitigation: 'Atualizar Express para 4.18.0 ou superior'
            }
        ],
        'webpack': [
            {
                cve: 'CVE-2021-23369',
                severity: 'HIGH',
                description: 'Regular Expression Denial of Service (ReDoS)',
                affectedVersions: 'webpack < 5.24.4',
                mitigation: 'Atualizar webpack para 5.24.4 ou superior'
            }
        ],
        'axios': [
            {
                cve: 'CVE-2020-28168',
                severity: 'MEDIUM',
                description: 'Regular Expression Denial of Service (ReDoS)',
                affectedVersions: 'axios < 0.21.1',
                mitigation: 'Atualizar axios para 0.21.1 ou superior'
            }
        ],
        'moment': [
            {
                cve: 'CVE-2022-24785',
                severity: 'HIGH',
                description: 'Regular Expression Denial of Service (ReDoS)',
                affectedVersions: 'moment < 2.29.2',
                mitigation: 'Atualizar moment para 2.29.2 ou superior'
            }
        ],
        'socket.io': [
            {
                cve: 'CVE-2023-32695',
                severity: 'HIGH',
                description: 'DoS atrav√©s de packet flooding',
                affectedVersions: 'socket.io < 4.6.2',
                mitigation: 'Atualizar socket.io para 4.6.2 ou superior'
            }
        ]
    },

    // Padr√µes de vulnerabilidade em c√≥digo
    vulnerabilityPatterns: [
        {
            id: 'CVE-PATTERN-001',
            name: 'Outdated Library Pattern',
            pattern: /(?:require|import|from)\s+['"`]([^'"`]+)['"`]/g,
            severity: 'MEDIUM',
            description: 'Importa√ß√£o de bibliotecas que podem estar desatualizadas',
            cwe: 'CWE-1104'
        },
        {
            id: 'CVE-PATTERN-002',
            name: 'Version Comment Pattern',
            pattern: /\/\/.*(?:version|v)\s*[:=]\s*['"]?(\d+\.\d+\.\d+)['"]?/gi,
            severity: 'LOW',
            description: 'Coment√°rios que indicam vers√µes espec√≠ficas',
            cwe: 'CWE-1104'
        },
        {
            id: 'CVE-PATTERN-003',
            name: 'Package.json Reference',
            pattern: /["'](?:dependencies|devDependencies)["']\s*:\s*{[\s\S]*?}/g,
            severity: 'MEDIUM',
            description: 'Refer√™ncias a package.json com depend√™ncias',
            cwe: 'CWE-1104'
        },
        {
            id: 'CVE-PATTERN-004',
            name: 'CDN URL with Version',
            pattern: /https?:\/\/cdn\.(?:jsdelivr|unpkg|cloudflare)\.com\/[^/]+\/([^/]+)\/(\d+\.\d+\.\d+)/g,
            severity: 'MEDIUM',
            description: 'CDN URLs com vers√µes espec√≠ficas',
            cwe: 'CWE-1104'
        }
    ]
};

/**
 * Classe principal do CVE Checker
 */
export class CVEChecker {
    constructor() {
        this.cveDatabase = CVE_DATABASE;
        this.detectedVulnerabilities = [];
        this.importedLibraries = [];
        this.scanResults = null;
    }

    /**
     * Scaneia c√≥digo em busca de vulnerabilidades conhecidas
     */
    scanCodeForCVEs(code) {
        this.detectedVulnerabilities = [];
        this.importedLibraries = [];
        
        // Extrair bibliotecas importadas
        this.extractImportedLibraries(code);
        
        // Verificar vulnerabilidades em bibliotecas
        this.checkLibraryVulnerabilities();
        
        // Verificar padr√µes de vulnerabilidade
        this.checkVulnerabilityPatterns(code);
        
        // Verificar CVEs espec√≠ficos
        this.checkSpecificCVEs(code);
        
        // Gerar relat√≥rio
        return this.generateReport();
    }

    /**
     * Extrai bibliotecas importadas do c√≥digo
     */
    extractImportedLibraries(code) {
        // Padr√µes de importa√ß√£o
        const importPatterns = [
            /(?:import|require)\s*\(?['"`]([^'"`/]+)['"`]\)?/g,
            /from\s+['"`]([^'"`/]+)['"`]/g,
            /<script\s+src=['"`].*\/([^/]+)\.js['"`]/gi
        ];
        
        importPatterns.forEach(pattern => {
            let match;
            while ((match = pattern.exec(code)) !== null) {
                const libName = match[1].split('/')[0]; // Pega apenas o nome principal
                if (!this.importedLibraries.includes(libName)) {
                    this.importedLibraries.push(libName);
                }
            }
        });
    }

    /**
     * Verifica vulnerabilidades em bibliotecas importadas
     */
    checkLibraryVulnerabilities() {
        this.importedLibraries.forEach(lib => {
            const libLower = lib.toLowerCase();
            
            // Verificar se a biblioteca est√° na base de dados
            Object.keys(this.cveDatabase.libraryVulnerabilities).forEach(libName => {
                if (libLower.includes(libName) || libName.includes(libLower)) {
                    const vulnerabilities = this.cveDatabase.libraryVulnerabilities[libName];
                    vulnerabilities.forEach(vuln => {
                        this.detectedVulnerabilities.push({
                            type: 'LIBRARY_VULNERABILITY',
                            library: libName,
                            cve: vuln.cve,
                            severity: vuln.severity,
                            description: vuln.description,
                            affectedVersions: vuln.affectedVersions,
                            mitigation: vuln.mitigation,
                            confidence: 'HIGH'
                        });
                    });
                }
            });
        });
    }

    /**
     * Verifica padr√µes de vulnerabilidade
     */
    checkVulnerabilityPatterns(code) {
        this.cveDatabase.vulnerabilityPatterns.forEach(pattern => {
            const matches = code.matchAll(pattern.pattern);
            for (const match of matches) {
                this.detectedVulnerabilities.push({
                    type: 'VULNERABILITY_PATTERN',
                    pattern: pattern.name,
                    severity: pattern.severity,
                    description: pattern.description,
                    match: match[0],
                    cwe: pattern.cwe,
                    confidence: 'MEDIUM'
                });
            }
        });
    }

    /**
     * Verifica CVEs espec√≠ficos
     */
    checkSpecificCVEs(code) {
        this.cveDatabase.javascriptCVEs.forEach(cve => {
            // Verificar se h√° men√ß√£o ao CVE no c√≥digo
            if (code.includes(cve.cve) || code.includes(cve.name.toLowerCase())) {
                this.detectedVulnerabilities.push({
                    type: 'SPECIFIC_CVE',
                    cve: cve.cve,
                    name: cve.name,
                    severity: cve.severity,
                    description: cve.description,
                    cvssScore: cve.cvssScore,
                    cwe: cve.cwe,
                    mitigation: cve.mitigation,
                    references: cve.references,
                    confidence: 'HIGH'
                });
            }
        });
    }

    /**
     * Gera relat√≥rio de CVEs
     */
    generateReport() {
        const critical = this.detectedVulnerabilities.filter(v => v.severity === 'CRITICAL');
        const high = this.detectedVulnerabilities.filter(v => v.severity === 'HIGH');
        const medium = this.detectedVulnerabilities.filter(v => v.severity === 'MEDIUM');
        const low = this.detectedVulnerabilities.filter(v => v.severity === 'LOW');

        // Calcular score de seguran√ßa (0-100)
        let securityScore = 100;
        securityScore -= critical.length * 15;
        securityScore -= high.length * 10;
        securityScore -= medium.length * 5;
        securityScore -= low.length * 2;
        securityScore = Math.max(0, Math.min(100, securityScore));

        // Determinar classifica√ß√£o
        let securityGrade = 'A+';
        if (securityScore >= 90) securityGrade = 'A+';
        else if (securityScore >= 80) securityGrade = 'A';
        else if (securityScore >= 70) securityGrade = 'B';
        else if (securityScore >= 60) securityGrade = 'C';
        else if (securityScore >= 50) securityGrade = 'D';
        else securityGrade = 'F';

        this.scanResults = {
            timestamp: new Date().toISOString(),
            detectedVulnerabilities: this.detectedVulnerabilities,
            importedLibraries: this.importedLibraries,
            summary: {
                totalVulnerabilities: this.detectedVulnerabilities.length,
                critical: critical.length,
                high: high.length,
                medium: medium.length,
                low: low.length,
                securityScore,
                securityGrade
            },
            recommendations: this.generateRecommendations()
        };

        return this.scanResults;
    }

    /**
     * Gera recomenda√ß√µes baseadas nas vulnerabilidades detectadas
     */
    generateRecommendations() {
        const recommendations = [];
        const criticalCount = this.detectedVulnerabilities.filter(v => v.severity === 'CRITICAL').length;
        const highCount = this.detectedVulnerabilities.filter(v => v.severity === 'HIGH').length;

        if (criticalCount > 0) {
            recommendations.push(`üö® Corrigir ${criticalCount} vulnerabilidades CR√çTICAS imediatamente`);
            recommendations.push('üîí Atualizar todas as bibliotecas para vers√µes seguras');
        }

        if (highCount > 0) {
            recommendations.push(`‚ö†Ô∏è Revisar ${highCount} vulnerabilidades ALTAS`);
            recommendations.push('üìö Verificar changelogs das bibliotecas usadas');
        }

        if (this.importedLibraries.length > 0) {
            recommendations.push('üîç Executar npm audit ou yarn audit para verificar depend√™ncias');
            recommendations.push('üì¶ Usar dependabot ou renovate para atualiza√ß√µes autom√°ticas');
        }

        recommendations.push('üõ°Ô∏è Implementar SAST (Static Application Security Testing) no pipeline CI/CD');
        recommendations.push('üåê Monitorar feeds de seguran√ßa como NVD, Snyk, GitHub Security Advisories');

        return recommendations;
    }

    /**
     * Busca informa√ß√µes de CVE espec√≠fico
     */
    async fetchCVEInfo(cveId) {
        try {
            // Tentar buscar da NVD API
            const response = await fetch(`https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=${cveId}`);
            if (response.ok) {
                const data = await response.json();
                return data.vulnerabilities?.[0]?.cve || null;
            }
        } catch (error) {
            console.warn(`N√£o foi poss√≠vel buscar informa√ß√µes do CVE ${cveId}:`, error);
        }

        // Fallback para dados locais
        const localCVE = this.cveDatabase.javascriptCVES.find(cve => cve.cve === cveId);
        return localCVE || null;
    }

    /**
     * Verifica se uma biblioteca espec√≠fica tem vulnerabilidades
     */
    checkLibrary(libraryName, version = null) {
        const vulnerabilities = [];
        const libLower = libraryName.toLowerCase();

        // Verificar na base de dados de bibliotecas
        Object.keys(this.cveDatabase.libraryVulnerabilities).forEach(libName => {
            if (libLower.includes(libName) || libName.includes(libLower)) {
                vulnerabilities.push(...this.cveDatabase.libraryVulnerabilities[libName]);
            }
        });

        // Verificar em CVEs gerais
        this.cveDatabase.javascriptCVES.forEach(cve => {
            if (cve.name.toLowerCase().includes(libLower)) {
                vulnerabilities.push(cve);
            }
        });

        return {
            library: libraryName,
            version,
            vulnerabilities,
            hasVulnerabilities: vulnerabilities.length > 0,
            criticalCount: vulnerabilities.filter(v => v.severity === 'CRITICAL').length,
            highCount: vulnerabilities.filter(v => v.severity === 'HIGH').length
        };
    }

    /**
     * Gera relat√≥rio HTML para exibi√ß√£o
     */
    generateHTMLReport(results) {
        const severityColors = {
            'CRITICAL': '#dc2626',
            'HIGH': '#ea580c',
            'MEDIUM': '#d97706',
            'LOW': '#059669'
        };

        let html = `
            <div style="padding: 20px; background: linear-gradient(135deg, #1a237e 0%, #283593 100%); color: white; border-radius: 20px;">
                <h2 style="margin-top: 0; display: flex; align-items: center; gap: 10px;">
                    üîç CVE Security Scan Report
                    <span style="background: linear-gradient(135deg, #4285f4, #34a853, #fbbc05, #ea4335); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold;">
                        GOOGLE SECURITY
                    </span>
                </h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; text-align: center; backdrop-filter: blur(10px);">
                        <div style="font-size: 12px; opacity: 0.8;">Security Score</div>
                        <div style="font-size: 36px; font-weight: bold; color: ${results.summary.securityScore >= 70 ? '#10b981' : results.summary.securityScore >= 50 ? '#f59e0b' : '#ef4444'}">
                            ${results.summary.securityScore}/100
                        </div>
                        <div style="font-size: 14px;">${results.summary.securityGrade}</div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; text-align: center; backdrop-filter: blur(10px);">
                        <div style="font-size: 12px; opacity: 0.8;">Total Vulnerabilities</div>
                        <div style="font-size: 36px; font-weight: bold;">${results.summary.totalVulnerabilities}</div>
                        <div style="font-size: 14px;">
                            <span style="color: #ef4444;">${results.summary.critical} Critical</span>
                            <span style="margin: 0 5px;">‚Ä¢</span>
                            <span style="color: #f59e0b;">${results.summary.high} High</span>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; text-align: center; backdrop-filter: blur(10px);">
                        <div style="font-size: 12px; opacity: 0.8;">Imported Libraries</div>
                        <div style="font-size: 36px; font-weight: bold;">${results.importedLibraries.length}</div>
                        <div style="font-size: 14px;">${results.importedLibraries.slice(0, 3).join(', ')}${results.importedLibraries.length > 3 ? '...' : ''}</div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; text-align: center; backdrop-filter: blur(10px);">
                        <div style="font-size: 12px; opacity: 0.8;">Scan Timestamp</div>
                        <div style="font-size: 18px; font-weight: bold;">${new Date(results.timestamp).toLocaleTimeString()}</div>
                        <div style="font-size: 12px;">${new Date(results.timestamp).toLocaleDateString()}</div>
                    </div>
                </div>
        `;

        // Se√ß√£o de vulnerabilidades detectadas
        if (results.detectedVulnerabilities.length > 0) {
            html += `
                <h3 style="border-bottom: 2px solid rgba(255,255,255,0.2); padding-bottom: 10px;">Detected Vulnerabilities</h3>
                <div style="max-height: 400px; overflow-y: auto; margin: 20px 0;">
            `;

            results.detectedVulnerabilities.forEach((vuln, index) => {
                html += `
                    <div style="background: rgba(0,0,0,0.3); border-left: 4px solid ${severityColors[vuln.severity]}; padding: 15px; margin-bottom: 10px; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <div style="font-weight: bold; font-size: 14px;">
                                ${vuln.cve ? vuln.cve : vuln.type}
                            </div>
                            <span style="background: ${severityColors[vuln.severity]}; color: white; padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: bold;">
                                ${vuln.severity}
                            </span>
                        </div>
                        <div style="font-size: 13px; margin-bottom: 8px; opacity: 0.9;">
                            ${vuln.description}
                        </div>
                        ${vuln.library ? `<div style="font-size: 12px; color: #94a3b8;">Library: ${vuln.library}</div>` : ''}
                        ${vuln.mitigation ? `<div style="font-size: 12px; color: #60a5fa; margin-top: 8px;"><strong>Mitigation:</strong> ${vuln.mitigation}</div>` : ''}
                        ${vuln.confidence ? `<div style="font-size: 11px; color: #94a3b8; margin-top: 5px;">Confidence: ${vuln.confidence}</div>` : ''}
                    </div>
                `;
            });

            html += `</div>`;
        } else {
            html += `
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 48px; margin-bottom: 20px;">‚úÖ</div>
                    <h3 style="margin: 0;">No CVE Vulnerabilities Found!</h3>
                    <p style="opacity: 0.8;">Your code appears to be free from known vulnerabilities.</p>
                </div>
            `;
        }

        // Se√ß√£o de recomenda√ß√µes
        if (results.recommendations.length > 0) {
            html += `
                <h3 style="border-bottom: 2px solid rgba(255,255,255,0.2); padding-bottom: 10px; margin-top: 30px;">Recommendations</h3>
                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; margin-top: 15px;">
                    <ul style="margin: 0; padding-left: 20px;">
            `;

            results.recommendations.forEach(rec => {
                html += `<li style="margin-bottom: 10px;">${rec}</li>`;
            });

            html += `
                    </ul>
                </div>
            `;
        }

        // Bibliotecas importadas
        if (results.importedLibraries.length > 0) {
            html += `
                <h3 style="border-bottom: 2px solid rgba(255,255,255,0.2); padding-bottom: 10px; margin-top: 30px;">Imported Libraries</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;">
            `;

            results.importedLibraries.forEach(lib => {
                const libCheck = this.checkLibrary(lib);
                const color = libCheck.hasVulnerabilities ? 
                    (libCheck.criticalCount > 0 ? '#ef4444' : '#f59e0b') : '#10b981';
                
                html += `
                    <div style="background: ${color}20; border: 1px solid ${color}40; padding: 8px 15px; border-radius: 20px; font-size: 12px; display: flex; align-items: center; gap: 8px;">
                        <span>üì¶</span>
                        <span>${lib}</span>
                        ${libCheck.hasVulnerabilities ? 
                            `<span style="background: ${color}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px;">
                                ${libCheck.criticalCount + libCheck.highCount} vulns
                            </span>` : ''
                        }
                    </div>
                `;
            });

            html += `</div>`;
        }

        html += `
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); text-align: center; font-size: 12px; opacity: 0.7;">
                    <p>Report generated by JS Inspector Pro Elite Security ‚Ä¢ CVE Scanner v1.0</p>
                    <p>¬© Google Security Research Division ‚Ä¢ Use security tools responsibly</p>
                </div>
            </div>
        `;

        return html;
    }

    /**
     * Exporta relat√≥rio em formato JSON
     */
    exportReportAsJSON(results, filename = 'cve_scan_report.json') {
        const data = {
            ...results,
            scannerInfo: {
                name: 'JS Inspector Pro Elite CVE Scanner',
                version: '1.0.0',
                timestamp: new Date().toISOString()
            }
        };

        const jsonString = JSON.stringify(data, null, 2);
        const blob = new Blob([jsonString], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }, 100);
    }
}

// Singleton para uso global
export const cveChecker = new CVEChecker();